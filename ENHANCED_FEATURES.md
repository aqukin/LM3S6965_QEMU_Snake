# 增强版贪吃蛇游戏功能说明

## 项目概述
这是一个基于 FreeRTOS 和 LM3S6965 微控制器的增强版贪吃蛇游戏，通过 QEMU 模拟器运行。游戏从原始的简单版本扩展为具有丰富功能的完整游戏系统。

## 新增功能详解

### 1. 游戏分数系统 ✅
- **动态计分**：根据蛇的当前长度和游戏等级计算得分
- **分数公式**：基础分数(10) + 长度奖励((长度-3)*5) + 等级奖励(等级*2)
- **最高分记录**：自动保存和显示历史最高分
- **实时显示**：游戏过程中实时显示当前分数和等级

### 2. 多级难度系统 ✅
- **自动升级**：每获得100分自动升一级
- **动态速度**：等级越高，蛇移动速度越快
- **速度计算**：基础延迟200ms，每级减少15ms，最快不超过50ms
- **等级显示**：实时显示当前等级

### 3. 简化的食物系统 ✅
- **普通食物**：标准分数，简单的方块显示
- **统一显示**：适合黑白OLED显示器的简洁设计
- **不过期**：食物不会消失，简化游戏逻辑
- **一致体验**：专注于核心游戏玩法而非复杂的特殊效果

### 4. 游戏状态管理系统 ✅
- **菜单状态**：显示游戏标题、操作说明和最高分
- **游戏进行状态**：正常游戏过程
- **暂停状态**：按P键暂停/恢复游戏
- **游戏结束状态**：显示最终分数、最高分和游戏时间
- **统计状态**：显示详细的游戏统计信息

### 5. 数据存储系统 ✅
- **模拟EEPROM**：使用静态变量模拟持久化存储
- **自动保存**：新纪录产生时自动保存最高分
- **数据恢复**：游戏启动时自动加载历史最高分
- **扩展性**：预留了真实EEPROM操作的接口

### 6. 音效和反馈系统 ✅
- **PWM蜂鸣器**：使用PWM信号模拟蜂鸣器音效
- **简化音效**：
  - 吃食物：1000Hz，100ms
  - 升级音效：1800Hz，400ms  
  - 游戏结束：300Hz，500ms
- **音效队列**：独立的音效播放任务，不阻塞游戏进程

### 7. 视觉效果优化 ✅
- **简洁显示**：适合黑白OLED的简洁食物显示
- **帧计数器**：预留动画效果的时序控制
- **状态显示**：清晰的界面分离和状态指示
- **黑白适配**：专为灰度显示优化的界面设计

### 8. 游戏统计和调试功能 ✅
- **游戏统计**：
  - 总游戏次数
  - 总食物数量
  - 历史最高分
  - 平均分数
- **按键操作**：按T键查看统计信息
- **数据分析**：帮助玩家了解游戏表现

## 控制说明

### 基本控制
- `W/A/S/D`：控制蛇的移动方向
- `P`：暂停/恢复游戏
- `R`：开始游戏/重新开始
- `T`：查看游戏统计信息

### 状态转换
```
菜单 → (R键) → 游戏中
菜单 → (T键) → 统计页面
游戏中 → (P键) → 暂停
游戏中 → (撞墙/自撞) → 游戏结束
暂停 → (P键) → 游戏中
游戏结束 → (R键) → 菜单
统计页面 → (R键) → 菜单
```

## 设计优化说明

### 移除特殊食物类型的原因
考虑到OLED显示器只有黑白灰度显示，复杂的特殊食物类型和闪烁效果并不能很好地体现出来。因此简化了食物系统：

- **简化前**：5种不同类型的食物，各自有不同的显示效果和特殊能力
- **简化后**：只保留普通食物，专注于核心游戏玩法
- **优势**：代码更简洁，适合黑白显示器，降低复杂度

这样的设计更适合嵌入式系统的实际硬件限制，体现了良好的工程实践。

### 多任务架构
- **游戏主逻辑任务**：处理游戏状态更新和碰撞检测
- **绘图任务**：负责OLED显示更新和动画效果
- **键盘输入任务**：处理UART输入和按键解析
- **音效播放任务**：独立的音效管理和PWM控制

### 线程安全
- **互斥锁保护**：使用FreeRTOS互斥锁保护共享游戏状态
- **消息队列**：键盘输入和音效播放通过队列通信
- **无锁优化**：绘图任务使用本地副本减少锁持有时间

### 内存使用
- **FLASH使用**：46,049字节 (17.57%)
- **SRAM使用**：60,144字节 (91.77%)
- **高效存储**：优化的数据结构和算法

## 运行说明

### 编译
```bash
cmake --preset debug
cmake --build ./build/ -- -j16
```

### 运行
```bash
# 普通模式
qemu-system-arm -kernel build/RTOSDemo.elf -machine lm3s6965evb -serial stdio

# 调试模式
qemu-system-arm -kernel build/RTOSDemo.elf -machine lm3s6965evb -serial stdio -s -S
```

### 游戏体验
1. 启动后显示游戏菜单
2. 按R开始游戏
3. 使用WASD控制蛇移动
4. 吃不同类型的食物获得分数和特殊效果
5. 通过升级提高难度
6. 游戏结束后查看统计信息

## 扩展性

该项目具有良好的扩展性，可以进一步添加：
- 更多特殊食物类型
- 网络对战功能
- 更复杂的关卡设计
- 图形界面优化
- 更多音效和音乐
- 成就系统
- 存档功能

这个增强版贪吃蛇游戏展示了嵌入式系统开发的多个重要概念，包括实时操作系统使用、多任务编程、硬件抽象、用户界面设计和游戏逻辑实现。